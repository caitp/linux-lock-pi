#!/usr/bin/env node
var LinuxLockService = function(config) {
  var LinuxLock = require('../lib')
  try {
    //
    // Load and normalize JSON configuration file.
    //
    this.config = LinuxLock.loadConfig(config)
    //
    // Construct service dependencies using instructions from the configuration
    // file.
    //
    this.client = new LinuxLock.Client(this.config.client)
    this.rfidReader = new LinuxLock.RFIDReader(this.config.rfidReader, false)
    this.gpio = new LinuxLock.GPIO(this.config.gpio)
  } catch(err) {
    //
    // If some error occurs, throw back to the caller.
    //
    throw err
  }
}

module.exports = exports = LinuxLockService

//
// Startup the application if we're the main script
//
if(!module.parent) {
  var service = new LinuxLockService('~/.linux-lock-service.json')
  service.rfidReader.enable()
}
